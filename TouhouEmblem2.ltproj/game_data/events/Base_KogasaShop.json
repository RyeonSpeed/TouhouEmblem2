[
    {
        "name": "KogasaShop",
        "trigger": "on_talk",
        "level_nid": "Base",
        "condition": "unit.nid == 'Reimu' and unit2.nid == 'Kogasa' and game.get_unit('Kogasa').team == 'player'",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "add_portrait;Kogasa;Left",
            "add_portrait;Reimu;Right",
            "speak;Kogasa;Hey! Do you need anything from me today?",
            "choice;Blacksmith;What do you need?;Repair,Forge;backable",
            "if;'{v:Blacksmith}' == 'Repair'",
            "",
            "    choice;RepairChoice;Whose items need fixing?;[x.nid for x in game.get_units_in_party('Reimu')];;;top_left;;;type_unit;6,1;scroll_bar;backable;expression",
            "",
            "    level_var;NoRepair;1",
            "    for;BRUH;[x.nid for x in u('{v:RepairChoice}').items]",
            "        if;'starting_uses' in get_item('{v:RepairChoice}','{BRUH}').data",
            "            if;get_item('{v:RepairChoice}','{BRUH}').data['starting_uses'] != get_item('{v:RepairChoice}','{BRUH}').data['uses']",
            "                level_var;NoRepair;0",
            "            end",
            "        end",
            "    endf",
            "    ",
            "    if;{v:NoRepair} == 0",
            "        repair_shop;{v:RepairChoice}",
            "    else",
            "        speak;Kogasa;There's nothing for me to repair!",
            "    end",
            "elif;'{v:Blacksmith}' == 'Forge'",
            "speak;Kogasa;Not available at the moment.",
            "end"
        ],
        "nid": "Base KogasaShop"
    }
]